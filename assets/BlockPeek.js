(function(t){const x=p(()=>y(),50);let E=null;function p(i,r){return function(...s){const d=this;clearTimeout(E),E=setTimeout(()=>i.apply(d,s),r)}}function g(){const i=t("iframe[data-iframe-preview]"),r=s=>{var d,u;if(((d=s.data)==null?void 0:d.type)==="resize"&&((u=s.data)!=null&&u.id)){const f=i.filter('[data-slice-id="'.concat(s.data.id,'"]'))[0];if(!f)return;const h=f.parentElement,m=parseFloat(h.dataset.zoomFactor)||.5;h.style.height=s.data.height*m+"px"}};window.removeEventListener("message",r),i.length&&window.addEventListener("message",r)}function y(){const i=window.location.hash.substring(1);if(i){const r=document.getElementById(i);r&&(clearTimeout(E),r.scrollIntoView({behavior:"auto"}))}}function S(){if(rex.page!=="content/edit")return;let i=!0,r=t(".rex-slice-edit");t('a.btn-edit[href*="slice_id"]').off("click.asyncEdit").on("click.asyncEdit",async function(e){e.preventDefault();const c=t(this),a=t(this).closest(".rex-slice"),n=a.attr("id");if(n){if(r.length){if(n===r.attr("id"))return;await m(r),r=null}f(),rex_loader.show();try{const o=await fetch(this.href,{method:"GET",headers:{"Content-Type":"text/html","X-Requested-With":"XMLHttpRequest"}});if(!o.ok)throw new Error("Network response was not ok");const w=await o.text(),l=t(w).find("#".concat(n));l.length&&(t(".panel-body .alert").remove(),u(n,a),a.replaceWith(l),t(document).trigger("rex:ready",[l]),h(l[0]),i&&history.pushState(null,"",c.attr("href")),i=!0),rex_loader.hide()}catch(o){console.error("Error editing slice:",o)}}});const d=e=>{e.scrollIntoView({behavior:"auto"})},u=(e,c)=>{rex.isSliceEditing=!0,rex.sliceEditCurrent=c.clone(!0,!0),rex.sliceEditCurrentId=e},f=()=>{if(rex.isSliceEditing&&rex.sliceEditCurrent){const e=t("#".concat(rex.sliceEditCurrentId));e.length&&e.hasClass("rex-slice-edit")&&e.replaceWith(rex.sliceEditCurrent),rex.isSliceEditing=!1,rex.sliceEditCurrent=null}},h=p(e=>d(e),50),m=async e=>{const c=e.attr("id"),n=t("#rex-js-structure-content-nav").find('a[href*="edit"]:first').attr("href");if(n)try{const o=await fetch(n,{method:"GET",headers:{"Content-Type":"text/html","X-Requested-With":"XMLHttpRequest"}});if(!o.ok)throw new Error("Network response was not ok");const w=await o.text(),l=t(w).find("#".concat(c));l.length&&(t(".panel-body .alert").remove(),u(c,e),e.replaceWith(l))}catch(o){console.error("Error restoring slice:",o)}};t(window).off("popstate.asyncEdit").on("popstate.asyncEdit",function(e){const a=new URLSearchParams(window.location.search).get("slice_id");if(a){const n=t("#slice".concat(a));n.length&&(i=!1,n.find("a.btn-edit").trigger("click.asyncEdit"))}else window.scrollTo({top:0,behavior:"auto"})})}t(document).on("rex:ready rex:selectMedia rex:YForm_selectData",function(){g(),x(),S()})})(jQuery);
//# sourceMappingURL=BlockPeek.js.map
