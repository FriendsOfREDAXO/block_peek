(e=>{let x=null;function S(h,o){return function(...u){clearTimeout(x),x=setTimeout(()=>h.apply(this,u),o)}}function v(){const h=e("iframe[data-iframe-preview]"),o=u=>{var m,g;if(((m=u.data)==null?void 0:m.type)==="resize"&&((g=u.data)!=null&&g.id)){const w=h.filter('[data-slice-id="'.concat(u.data.id,'"]'))[0];if(!w)return;const y=w.parentElement,E=parseFloat(y.dataset.zoomFactor)||.5;y.style.height="".concat(u.data.height*E,"px")}};window.removeEventListener("message",o),h.length&&window.addEventListener("message",o)}function b(){if(rex.page!=="content/edit")return;let h=!0,o=e(".rex-slice-edit");const u=()=>{e('a.btn-edit[href*="slice_id"]').off("click.asyncEdit").on("click.asyncEdit",async function(r){r.preventDefault();const i=e(this),a=e(this).closest(".rex-slice"),n=a.attr("id");if(n){if(o.length){if(o&&n===o.attr("id"))return;await k(o),o=null}y(),rex_loader.show();try{const l=await fetch(this.href,{method:"GET",headers:{"Content-Type":"text/html","X-Requested-With":"XMLHttpRequest"}});if(!l.ok)throw new Error("Network response was not ok");const p=await l.text(),c=e(p).find("#".concat(n));c.length&&(e(".panel-body .alert").remove(),w(n,a),a.replaceWith(c),e(document).trigger("rex:ready",[c]),m(c),E(c[0]),h&&history.pushState(null,"",i.attr("href")),h=!0),rex_loader.hide()}catch(l){console.error("Error editing slice:",l)}}})},m=t=>{const r=t.find("form"),i=t.find(".btn-save"),a=t.find(".btn-apply");i.length&&(r.length&&r.off("submit.asyncSave").on("submit.asyncSave",n=>{n.preventDefault(),i.trigger("click.asyncSave")}),i.off("click.asyncSave").on("click.asyncSave",n=>{n.preventDefault();const l=i.attr("name"),p=i.attr("value"),c=new FormData(r[0]);c.append(l,p),fetch(r.attr("action"),{method:"POST",body:c}).then(d=>{if(!d.ok)throw new Error("Network response was not ok");return d.text()}).then(d=>{const s=e(d).find("#".concat(t.attr("id")));if(s.length&&(t.replaceWith(s),E(s[0]),o=[],u(),window.location.search.includes("function=edit"))){const f=new URL(window.location);f.searchParams.delete("function"),window.history.replaceState(null,"",f.toString())}e(document).trigger("rex:ready",[s||t])}).catch(d=>{console.error("Error saving slice:",d)})})),a.length&&a.off("click.asyncApply").on("click.asyncApply",n=>{n.preventDefault();const l=a.attr("name"),p=a.attr("value"),c=new FormData(r[0]);c.append(l,p);const d=window.scrollY;fetch(r.attr("action"),{method:"POST",body:c}).then(s=>{if(!s.ok)throw new Error("Network response was not ok");return s.text()}).then(s=>{const f=e(s).find("#".concat(t.attr("id")));f.length&&(t.replaceWith(f),w(f.attr("id"),f),o=f,d&&(console.log("Restoring scroll position:",d),setTimeout(()=>{window.scrollTo({top:d,behavior:"instant"})}))),e(document).trigger("rex:ready",[f||t])}).catch(s=>{console.error("Error updating slice:",s)})})};o.length&&m(o);const g=t=>{t.scrollIntoView({behavior:"auto"})},w=(t,r)=>{rex.isSliceEditing=!0,rex.sliceEditCurrent=r.clone(!0,!0),rex.sliceEditCurrentId=t},y=()=>{if(rex.isSliceEditing&&rex.sliceEditCurrent){const t=e("#".concat(rex.sliceEditCurrentId));t.length&&t.hasClass("rex-slice-edit")&&t.replaceWith(rex.sliceEditCurrent),rex.isSliceEditing=!1,rex.sliceEditCurrent=null}},E=S(t=>g(t),50),k=async t=>{const r=t.attr("id"),a=e("#rex-js-structure-content-nav").find('a[href*="edit"]:first').attr("href");if(a)try{const n=await fetch(a,{method:"GET",headers:{"Content-Type":"text/html","X-Requested-With":"XMLHttpRequest"}});if(!n.ok)throw new Error("Network response was not ok");const l=await n.text(),p=e(l).find("#".concat(r));p.length&&(e(".panel-body .alert").remove(),w(r,t),t.replaceWith(p))}catch(n){console.error("Error restoring slice:",n)}};e(window).off("popstate.asyncEdit").on("popstate.asyncEdit",()=>{const r=new URLSearchParams(window.location.search).get("slice_id");if(r){const i=e("#slice".concat(r));i.length&&(h=!1,i.find("a.btn-edit").trigger("click.asyncEdit"))}else window.scrollTo({top:0,behavior:"auto"})}),u()}e(document).on("rex:ready rex:selectMedia rex:YForm_selectData",()=>{v(),b()})})(jQuery);
//# sourceMappingURL=BlockPeek.js.map
