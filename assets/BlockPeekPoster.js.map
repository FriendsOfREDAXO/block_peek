{"version":3,"file":"BlockPeekPoster.js","sources":["../assets-src/BlockPeekPoster.js"],"sourcesContent":["'use strict'\n\nconst SLICE_ID = BLOCK_PEEK_PLACEHOLDER_SLICE_ID\nconst maxHeight = BLOCK_PEEK_PLACEHOLDER_MAX_HEIGHT || 10000\nconst DEBOUNCE_DELAY = 50\nconst PERIODIC_CHECK_INTERVAL = 5000\nconst SLICE_WRAPPER = document.body\n\nlet lastHeight = 0\nlet periodicTimer = null\nlet debounceTimer = null\n\nfunction debounce(func, delay) {\n  return function (...args) {\n    const context = this\n    clearTimeout(debounceTimer)\n    debounceTimer = setTimeout(() => func.apply(context, args), delay)\n  }\n}\n\n// Get current SLICE_WRAPPER height\nfunction getCurrentHeight() {\n  return Math.min(\n    Math.max(\n      SLICE_WRAPPER.scrollHeight,\n      SLICE_WRAPPER.offsetHeight,\n      SLICE_WRAPPER.clientHeight\n    ),\n    maxHeight\n  )\n}\n\n// Send height to parent if it has changed\nfunction sendHeight() {\n  const currentHeight = getCurrentHeight()\n\n  // Only send if height has actually changed\n  if (currentHeight !== lastHeight) {\n    lastHeight = currentHeight\n\n    try {\n      parent.postMessage(\n        {\n          type: 'resize',\n          id: SLICE_ID,\n          height: currentHeight,\n          timestamp: Date.now()\n        },\n        '*'\n      )\n    } catch (error) {\n      console.warn('Failed to send height to parent:', error)\n    }\n  }\n}\n\n// Debounced version for resize events\nconst debouncedSendHeight = debounce(sendHeight, DEBOUNCE_DELAY)\n\n// Initialize the script\nfunction init() {\n  // Clean up any existing listeners/timers\n  cleanup()\n\n  // Add event listeners\n  // window.addEventListener('load', sendHeight)\n  // window.addEventListener('resize', debouncedSendHeight)\n\n  // Optional: Listen for DOM mutations that might change height\n  if ('MutationObserver' in window) {\n    const observer = new MutationObserver(debouncedSendHeight)\n    observer.observe(document.body, {\n      childList: true,\n      subtree: true,\n      attributes: true,\n      attributeFilter: ['style', 'class']\n    })\n\n    // Store observer for cleanup\n    window.__heightObserver = observer\n  }\n\n  // Periodic check for height changes (fallback)\n  // periodicTimer = setInterval(sendHeight, PERIODIC_CHECK_INTERVAL)\n\n  // Send initial height\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', sendHeight)\n  } else {\n    sendHeight()\n  }\n}\n\n// Cleanup function\nfunction cleanup() {\n  window.removeEventListener('load', sendHeight)\n  window.removeEventListener('resize', debouncedSendHeight)\n  document.removeEventListener('DOMContentLoaded', sendHeight)\n\n  if (periodicTimer) {\n    clearInterval(periodicTimer)\n    periodicTimer = null\n  }\n\n  if (window.__heightObserver) {\n    window.__heightObserver.disconnect()\n    delete window.__heightObserver\n  }\n}\n\n// Handle page unload\nwindow.addEventListener('beforeunload', cleanup)\n\n// Initialize\ninit()\n"],"names":["SLICE_ID","maxHeight","DEBOUNCE_DELAY","SLICE_WRAPPER","lastHeight","debounceTimer","debounce","func","delay","args","context","getCurrentHeight","sendHeight","currentHeight","error","debouncedSendHeight","init","cleanup","observer"],"mappings":"AAEA,MAAMA,EAAW,gCACXC,EAAY,mCAAqC,IACjDC,EAAiB,GAEjBC,EAAgB,SAAS,KAE/B,IAAIC,EAAa,EAEbC,EAAgB,KAEpB,SAASC,EAASC,EAAMC,EAAO,CAC7B,OAAO,YAAaC,EAAM,CACxB,MAAMC,EAAU,KAChB,aAAaL,CAAa,EAC1BA,EAAgB,WAAW,IAAME,EAAK,MAAMG,EAASD,CAAI,EAAGD,CAAK,CACnE,CACF,CAGA,SAASG,GAAmB,CAC1B,OAAO,KAAK,IACV,KAAK,IACHR,EAAc,aACdA,EAAc,aACdA,EAAc,YACpB,EACIF,CACJ,CACA,CAGA,SAASW,GAAa,CACpB,MAAMC,EAAgBF,EAAgB,EAGtC,GAAIE,IAAkBT,EAAY,CAChCA,EAAaS,EAEb,GAAI,CACF,OAAO,YACL,CACE,KAAM,SACN,GAAIb,EACJ,OAAQa,EACR,UAAW,KAAK,IAAG,CAC7B,EACQ,GACR,CACI,OAASC,EAAO,CACd,QAAQ,KAAK,mCAAoCA,CAAK,CACxD,CACF,CACF,CAGA,MAAMC,EAAsBT,EAASM,EAAYV,CAAc,EAG/D,SAASc,GAAO,CASd,GAPAC,EAAO,EAOH,qBAAsB,OAAQ,CAChC,MAAMC,EAAW,IAAI,iBAAiBH,CAAmB,EACzDG,EAAS,QAAQ,SAAS,KAAM,CAC9B,UAAW,GACX,QAAS,GACT,WAAY,GACZ,gBAAiB,CAAC,QAAS,OAAO,CACxC,CAAK,EAGD,OAAO,iBAAmBA,CAC5B,CAMI,SAAS,aAAe,UAC1B,SAAS,iBAAiB,mBAAoBN,CAAU,EAExDA,EAAU,CAEd,CAGA,SAASK,GAAU,CACjB,OAAO,oBAAoB,OAAQL,CAAU,EAC7C,OAAO,oBAAoB,SAAUG,CAAmB,EACxD,SAAS,oBAAoB,mBAAoBH,CAAU,EAOvD,OAAO,mBACT,OAAO,iBAAiB,WAAU,EAClC,OAAO,OAAO,iBAElB,CAGA,OAAO,iBAAiB,eAAgBK,CAAO,EAG/CD,EAAI"}